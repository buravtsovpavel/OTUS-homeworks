##Домашнее задание

**VPN**

---
**Описание домашнего задания**
1. Между двумя виртуалками поднять vpn в режимах:

- tun

- tap

Описать в чём разница, замерить скорость между виртуальными
машинами в туннелях, сделать вывод об отличающихся показателях
скорости.

2. Поднять RAS на базе OpenVPN с клиентскими сертификатами,
подключиться с локальной машины на виртуалку.

Формат сдачи: Vagrantfile + ansible


---

###1. Между двумя виртуалками поднять vpn в режимах:

- tun

- tap

В результате запуска предподготовленного Vagrantfile(ссылка) поднимаются две виртуальные машины server и client. Для преднастройки написан ansible-playbook. 
Для изменения режима работы (tun или tap) необходимо в конфигарационном файле
сервера(ссылка) и клиента(ссылка) изменять значение директивы dev и заново запустить провижинг:

```
vagrant provision
```
**Замеры скорости в туннеле для режима tap:**

картинка1

**Замеры скорости в туннеле для режима tun:**

картинка2

Видно незначительное увеличение объёма переданных данных.


В терминологии компьютерных сетей, TUN и TAP — виртуальные сетевые драйверы ядра системы. Они представляют собой программные сетевые устройства, которые отличаются от обычных аппаратных сетевых карт.

TAP эмулирует Ethernet-устройство и работает на канальном уровне модели OSI, оперируя кадрами Ethernet. TUN (сетевой туннель) работает на сетевом уровне модели OSI, оперируя IP-пакетами. TAP используется для создания сетевого моста, тогда как TUN — для маршрутизации. 

TAP:

Преимущества:
- ведёт себя как настоящий сетевой адаптер (за исключением того, что он виртуальный);
- может осуществлять транспорт любого сетевого протокола (IPv4, IPv6, IPX и прочих);
- работает на 2 уровне, поэтому может передавать Ethernet-кадры внутри тоннеля;
- позволяет использовать мосты.

Недостатки:
- в тоннель попадает broadcast-трафик, что иногда не требуется;
- добавляет свои заголовки поверх заголовков Ethernet на все пакеты, которые следуют через тоннель;
- в целом, менее масштабируем из-за предыдущих двух пунктов;
- не поддерживается устройствами Android и iOS.

TUN:

Преимущества:
- передает только пакеты протокола IP (3й уровень);
- сравнительно (отн. TAP) меньшие накладные расходы и, фактически, ходит только тот IP-трафик, который предназначен конкретному клиенту.

Недостатки:
- broadcast-трафик обычно не передаётся;
- нельзя использовать мосты.

###2. Поднять RAS на базе OpenVPN с клиентскими сертификатами,

В результате запуска предподготовленного Vagrantfile(ссылка) поднимаются две виртуальные машины server и client. Для преднастройки написан ansible-playbook. 

Проверяем пинг по внутреннему IP адресу сервера в туннеле.

```
[root@client ~]# ping -c 4 10.10.10.1
PING 10.10.10.1 (10.10.10.1) 56(84) bytes of data.
64 bytes from 10.10.10.1: icmp_seq=1 ttl=64 time=1.13 ms
64 bytes from 10.10.10.1: icmp_seq=2 ttl=64 time=0.784 ms
64 bytes from 10.10.10.1: icmp_seq=3 ttl=64 time=0.766 ms
64 bytes from 10.10.10.1: icmp_seq=4 ttl=64 time=1.40 ms

--- 10.10.10.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3089ms
rtt min/avg/max/mdev = 0.766/1.019/1.398/0.263 ms

```

```
[root@client ~]# netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         10.0.2.2        0.0.0.0         UG        0 0          0 eth0
10.0.2.0        0.0.0.0         255.255.255.0   U         0 0          0 eth0
10.10.10.0      10.10.10.5      255.255.255.0   UG        0 0          0 tun0
10.10.10.5      0.0.0.0         255.255.255.255 UH        0 0          0 tun0
192.168.56.0    0.0.0.0         255.255.255.0   U         0 0          0 eth1
[root@client ~]# ip r
default via 10.0.2.2 dev eth0 proto dhcp metric 100 
10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15 metric 100 
10.10.10.0/24 via 10.10.10.5 dev tun0 
10.10.10.5 dev tun0 proto kernel scope link src 10.10.10.6 
192.168.56.0/24 dev eth1 proto kernel scope link src 192.168.56.20 metric 101 
[root@client ~]# 

```